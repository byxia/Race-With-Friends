
<!DOCTYPE HTML>
<html>
<head>
    <title>Simple client for simple node server</title>
</head>
<body>
    message: <input id="messageText" type="text" />
    <br>
    <button id="getButton">get</button>
    <button id="setButton">set</button>
    <script src="jquery.js"></script>

    <script>
        function callCmd(cmd, args, onSuccessFn, onErrFn) {
            var request = new XMLHttpRequest();
            var isAsynchronous = true;
            var url = "/" + cmd;
            var separator = "?";
            for (var key in args) {
                url += separator;
                url += key + "=" + args[key];
                separator = "&";
            }
            request.open("POST", url, isAsynchronous);
            request.onload = function(xmlEvent) {
                var responseObject = JSON.parse(request.response);
                if ("err" in responseObject) {
                    console.log(responseObject.err);
                    onErrFn(responseObject.err);
                }
                else {
                    onSuccessFn(responseObject.result);
                }
            };
            request.send();
        }

    </script>

    <script type="text/javascript">

    function sendAjaxRequest (requestURL, isAsync, onSuccess, onError) {
        if(isNull(onSuccess) || typeof(onSuccess)!=="function") {
            onSuccess = function(obj){
                log(obj);
            }
        }
        if(isNull(onError) || typeof(onError)!=="function"){
            onError = function(obj){
                log(obj);
            }
        }
        if(!validString(requestURL)){
            onError("No url provided to the ajax request.");
            return;
        }
        if(isNull(isAsync)){
            isAsync = true;
        }
        $.ajax({
            url : requestURL,
            async : isAsync,
            timeout : 10000,
            type : "GET",
            success: function(data, textStatus, jqXHR) {
                onSuccess(data);
            },
            error: function(jqXHR, textStatus, errorThrown){
                onError(jqXHR);
            }

        });
    }

    /*=====Util=====*/
    function validString(s){
      return (!isNull(s)) && typeof(s)==="string" && s.trim().length >0 ;
    }

    function isNull(obj){
      return obj == undefined || obj == null
              || obj === undefined || obj === null;
    }

    function log(obj){
      console.log(obj);
    }


    </script>
    
    <script>
        window.onload = function() {
            var getButton = document.getElementById("getButton");
            var setButton = document.getElementById("setButton");
            var messageText = document.getElementById("messageText");
            getButton.onclick = function() {
                var cmd = "getMsg";
                var args = { };
                function onSuccessFn(result) {
                    console.log("getMsg: result = " + result);
                    messageText.value = result;
                }
                function onErrFn(err) {
                    console.log("getMsg: err = " + err);
                    messageText.value = err;
                }
                callCmd(cmd, args, onSuccessFn, onErrFn);
            };
            setButton.onclick = function() {
                var cmd = "setMsg";
                var args = { "msg" : messageText.value};
                function onSuccessFn(result) {
                    console.log("setMsg: result = " + result);
                    messageText.value = result;
                }
                function onErrFn(err) {
                    console.log("setMsg: err = " + err);
                    messageText.value = err;
                }
                callCmd(cmd, args, onSuccessFn, onErrFn);
            };
        };
    </script>
</body>
</html>

